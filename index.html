<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DINO EMPIRE: MEGA EDITION</title>
    <style>
        :root { 
            --comum: #7f8c8d; --incomum: #2ecc71; --raro: #00d4ff; 
            --epico: #a55eea; --lendario: #f1c40f; --hibrido: #ff00ff; --ceno: #00f2ff;
            --n: #00d4ff; --bg: #02050a;
        }
        * { box-sizing: border-box; font-family: 'Orbitron', sans-serif; user-select: none; outline:none; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; touch-action: none; }

        /* HUD */
        #hud { display: grid; grid-template-columns: repeat(4, 1fr); background: rgba(5, 10, 20, 0.95); padding: 15px; position: fixed; width: 100%; top: 0; z-index: 1000; border-bottom: 2px solid var(--n); }
        .v { font-size: 13px; font-weight: 900; color: #fff; }
        .l { font-size: 8px; color: var(--n); text-transform: uppercase; display: block; }

        #btn-map-toggle { cursor:pointer; text-align:center; border-radius:8px; border:1px solid var(--n); transition: 0.3s; }
        .active-ceno { border-color: var(--ceno) !important; background: rgba(0, 242, 255, 0.2); box-shadow: 0 0 10px var(--ceno); }

        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        #map { position: absolute; width: 8000px; height: 8000px; transform-origin: 0 0; }
        .map-normal { background-color: #02050a; background-image: linear-gradient(rgba(0, 212, 255, 0.05) 1.5px, transparent 1.5px), linear-gradient(90deg, rgba(0, 212, 255, 0.05) 1.5px, transparent 1.5px); background-size: 80px 80px; }
        .map-ceno { background-color: #0d2533; background-image: radial-gradient(circle, #00f2ff22 1px, transparent 1px); background-size: 50px 50px; }
        
        .entity { position: absolute; transform: translate(-50%, -50%); z-index: 10; }
        .cage { width: 110px; height: 110px; border: 3px solid #fff; border-radius: 25px; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; position: relative; }
        .income-tag { position: absolute; bottom: -25px; background: #000; color: #2ecc71; padding: 2px 8px; border-radius: 5px; font-size: 10px; font-weight: 900; border: 1px solid #2ecc71; white-space: nowrap; }
        .lvl-badge { position: absolute; top: -12px; background: #fff; color: #000; padding: 2px 10px; border-radius: 10px; font-size: 9px; font-weight: 900; border: 2px solid var(--n); }

        .placement-guide { position: absolute; width: 150px; height: 150px; border: 3px dashed var(--n); border-radius: 50%; transform: translate(-50%, -50%); background: rgba(0, 212, 255, 0.1); pointer-events: none; z-index: 5; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { scale: 0.9; opacity: 0.3; } 50% { scale: 1.1; opacity: 0.7; } }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.96); padding: 20px; display: none; z-index: 5000; overflow-y: auto; }
        .m-card { background: #0d1526; border: 2px solid var(--n); border-radius: 30px; padding: 20px; max-width: 500px; margin: auto; }
        .btn { background: var(--n); color: #000; border: none; padding: 12px; border-radius: 12px; width: 100%; margin: 4px 0; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 11px; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }

        nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: rgba(5, 10, 20, 0.98); border-top: 2px solid var(--n); display: flex; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 8px; }
        .nav-item span { font-size: 22px; margin-bottom: 3px; }

        #panel { position: fixed; bottom: 95px; left: 5%; width: 90%; background: #0d1526; border: 2px solid var(--n); border-radius: 25px; padding: 15px; display: none; z-index: 2000; }
        #log { position: fixed; bottom: 95px; left: 10px; pointer-events: none; z-index: 4000; }
        .log-msg { background: rgba(0,0,0,0.9); color: var(--n); padding: 8px 15px; border-radius: 8px; margin-top: 5px; font-size: 10px; border-left: 4px solid var(--n); animation: fO 4s forwards; }

        .rar-comum { border-color: var(--comum); }
        .rar-incomum { border-color: var(--incomum); }
        .rar-raro { border-color: var(--raro); box-shadow: 0 0 10px var(--raro); }
        .rar-epico { border-color: var(--epico); box-shadow: 0 0 15px var(--epico); }
        .rar-lendario { border-color: var(--lendario); box-shadow: 0 0 20px var(--lendario); }
        .rar-hibrido { border-color: var(--hibrido); box-shadow: 0 0 20px var(--hibrido); }

        /* Estilo para lista de invent√°rio com bot√£o vender */
        .inv-row { display: flex; gap: 5px; margin-bottom: 5px; align-items: stretch; }
        .btn-sell-inv { background: #ff4757 !important; color: #fff !important; width: 80px !important; }

        @keyframes fO { 0% { opacity: 1; } 100% { opacity: 0; transform: translateX(-30px); } }
    </style>
</head>
<body>

<div id="log"></div>

<div id="hud">
    <div><span class="l">CR√âDITOS</span><span id="v-cash" class="v">$0</span></div>
    <div><span class="l">CARNE</span><span id="v-food" class="v">0</span></div>
    <div><span class="l">CENO-DNA</span><span id="v-ceno" class="v">0</span></div>
    <div id="btn-map-toggle" onclick="switchWorld()">
        <span class="l">MAPA</span><span id="v-world" class="v">NORMAL</span>
    </div>
</div>

<div id="viewport">
    <div id="map" class="map-normal">
        <div id="placement-indicator" class="placement-guide" style="display:none"></div>
        <div id="entities-layer"></div>
    </div>
</div>

<button id="btn-confirm" class="btn" style="position:fixed; bottom:100px; left:50%; transform:translateX(-50%); width:200px; display:none; z-index:4000; background:var(--incomum); border: 2px solid #fff" onclick="confirmPlacement()">SOLTAR AQUI ‚úÖ</button>

<div id="modal-shop" class="modal"><div class="m-card"><h2>LOJA</h2><div style="display:grid; grid-template-columns:1fr 1fr; gap:8px"><button class="btn" onclick="buy('carn', 30000)">ü•© CARN√çVOROS<br>$30K</button><button class="btn" onclick="buy('herb', 20000)">üåø HERB√çVOROS<br>$20K</button><button class="btn" onclick="buy('fly', 45000)">ü¶Ö VOADORES<br>$45K</button><button class="btn" onclick="buy('wat', 70000)">ü¶à AQU√ÅTICOS<br>$70K</button></div><button class="btn" style="background:var(--ceno); margin-top:10px; border:2px solid #fff" onclick="buy('ceno', 0)">üß¨ USAR CENO-DNA (1)</button><button class="btn" style="background:#333; color:#fff" onclick="closeModals()">FECHAR</button></div></div>

<div id="modal-lab" class="modal"><div class="m-card"><h2>LABORAT√ìRIO</h2><div style="background:rgba(0,0,0,0.5); padding:10px; border-radius:15px; border-left:4px solid var(--hibrido); margin-bottom:10px"><b>INDOMINUS REX ($500K)</b><br><small>T-Rex Lvl 30 + Raptor Lvl 30</small></div><button class="btn" onclick="fuse('Indominus Rex')">üß¨ FUNDIR INDOMINUS</button><div style="background:rgba(0,0,0,0.5); padding:10px; border-radius:15px; border-left:4px solid var(--hibrido); margin:10px 0"><b>INDORAPTOR ($1M)</b><br><small>Indominus Lvl 30 + Raptor Lvl 30</small></div><button class="btn" onclick="fuse('Indoraptor')">üß¨ FUNDIR INDORAPTOR (OP)</button><button class="btn" style="background:#333" onclick="closeModals()">FECHAR</button></div></div>

<div id="modal-exp" class="modal"><div class="m-card"><h2>EXPEDI√á√ÉO GLOBAL</h2><div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; border: 1px solid var(--n)"><b>MISS√ÉO DE BUSCA</b><br><p>Custo: $75K | Tempo: 40s</p><button id="exp-btn" class="btn" onclick="startExp(40, 75000)">INICIAR</button></div><p id="exp-timer" style="text-align:center; color:var(--n); font-weight:900"></p><button class="btn" style="background:#333" onclick="closeModals()">FECHAR</button></div></div>

<div id="modal-index" class="modal"><div class="m-card"><h2>DINOP√âDIA (100)</h2><div id="idx-list" style="display:grid; grid-template-columns:repeat(2,1fr); gap:6px"></div><button class="btn" onclick="closeModals()">FECHAR</button></div></div>
<div id="modal-inv" class="modal"><div class="m-card"><h2>INVENT√ÅRIO</h2><div id="inv-grid"></div><button class="btn" onclick="closeModals()">FECHAR</button></div></div>

<div id="panel">
    <h2 id="p-name" style="margin:0"></h2>
    <div id="p-stats" style="margin:10px 0; font-size:12px; color:#aaa"></div>
    <button class="btn" onclick="upgradeDino()">ü•© ALIMENTAR ($<span id="p-up-cost"></span>)</button>
    <button class="btn" style="background:#f1c40f" onclick="initMove()">üöö MOVER</button>
    <button class="btn" style="background:#e74c3c; color:#fff" onclick="sellDino()">VENDER</button>
    <button class="btn" style="background:#333; color:#fff" onclick="closePanel()">VOLTAR</button>
</div>

<nav>
    <div class="nav-item" onclick="openModal('shop')"><span>üõí</span>LOJA</div>
    <div class="nav-item" onclick="openModal('lab')"><span>üß™</span>LAB</div>
    <div class="nav-item" onclick="openModal('exp')"><span>üó∫Ô∏è</span>EXPED</div>
    <div class="nav-item" onclick="openModal('index')"><span>üìñ</span>INDEX</div>
    <div class="nav-item" onclick="openModal('inv')"><span>üß¨</span>INV</div>
    <div class="nav-item" id="btn-food"><span>ü•©</span>CARNE</div>
</nav>

<script>
function abb(n) {
    if(n >= 1e9) return (n/1e9).toFixed(1).replace(/\.0$/,'')+'B';
    if(n >= 1e6) return (n/1e6).toFixed(1).replace(/\.0$/,'')+'M';
    if(n >= 1e3) return (n/1e3).toFixed(1).replace(/\.0$/,'')+'K';
    return Math.floor(n).toString();
}

const DATA = {
    carn: [{n:"Tyrannosaurus Rex", e:"ü¶ñ"}, {n:"Velociraptor", e:"ü¶é"}, {n:"Spinosaurus", e:"üêä"}],
    herb: [{n:"Triceratops", e:"üöú"}, {n:"Brachiosaurus", e:"ü¶ï"}, {n:"Stegosaurus", e:"üõ°Ô∏è"}],
    fly: [{n:"Pteranodon", e:"ü¶Ö"}, {n:"Quetzalcoatlus", e:"‚úàÔ∏è"}],
    wat: [{n:"Mosasaurus", e:"ü¶à"}, {n:"Plesiosaurus", e:"üêç"}],
    ceno: [{n:"Tigre Dente de Sabre", e:"üêÖ"}, {n:"Mammuthus", e:"ü¶£"}],
    hibrido: [{n:"Indominus Rex", e:"üß¨"}, {n:"Indoraptor", e:"üñ§"}]
};

let state = { cash: 100000, food: 100000, cenoDNA: 0, dinos: [], inv: [], discovered: [], expEnd: 0, world: 'normal', cam: {x:-3800, y:-3800} };

function tick() {
    let inc = 0;
    state.dinos.forEach(d => {
        let b = (d.cat === 'ceno' || d.rar === 'hibrido') ? 1500 : 250;
        let m = {comum:1, incomum:3, raro:10, epico:30, lendario:100, hibrido:400}[d.rar] || 1;
        
        // DOBRO de lucro para o Indoraptor
        if(d.name === "Indoraptor") m = 800; 

        let p = (d.lvl * b * m) / 10; inc += p; d.lastInc = p * 10;
    });
    state.cash += inc;

    if(state.expEnd > Date.now()) {
        document.getElementById('exp-timer').innerText = `Expedi√ß√£o: ${Math.ceil((state.expEnd - Date.now())/1000)}s`;
        document.getElementById('exp-btn').disabled = true;
    } else {
        if(state.expEnd !== 0) finishExp();
        document.getElementById('exp-timer').innerText = "";
        document.getElementById('exp-btn').disabled = false;
    }

    document.getElementById('v-cash').innerText = "$" + abb(state.cash);
    document.getElementById('v-food').innerText = abb(state.food);
    document.getElementById('v-ceno').innerText = state.cenoDNA;
    updateLabels();
}

function switchWorld() {
    state.world = state.world === 'normal' ? 'ceno' : 'normal';
    document.getElementById('v-world').innerText = state.world.toUpperCase();
    document.getElementById('map').className = 'map-' + state.world;
    render();
}

function buy(cat, p) {
    if(cat === 'ceno' && state.cenoDNA < 1) return alert("DNA insuficiente!");
    if(state.cash < p && cat !== 'ceno') return alert("Saldo insuficiente!");
    if(cat === 'ceno') state.cenoDNA--; else state.cash -= p;
    state.inv.push(generate(cat));
    openModal('inv');
}

function generate(cat, forced = null) {
    const pool = DATA[cat] || DATA.carn;
    let obj = forced ? pool.find(x => x.n === forced) : pool[Math.floor(Math.random() * pool.length)];
    let rar = forced ? 'hibrido' : (Math.random() > 0.9 ? 'lendario' : 'comum');
    if(!state.discovered.includes(obj.n)) state.discovered.push(obj.n);
    return { name: obj.n, img: obj.e, cat, rar, lvl: 1, x:0, y:0, world: (cat==='ceno'?'ceno':'normal'), lastInc: 0 };
}

function openModal(id) {
    closeModals(); document.getElementById('modal-'+id).style.display = 'block';
    if(id === 'inv') {
        const g = document.getElementById('inv-grid'); g.innerHTML = '';
        state.inv.forEach((d, i) => {
            const row = document.createElement('div');
            row.className = 'inv-row';
            row.innerHTML = `
                <button class="btn" style="flex:1" onclick="startPlacement(${i})">${d.img} ${d.name}</button>
                <button class="btn btn-sell-inv" onclick="sellInv(${i})">VENDER</button>
            `;
            g.appendChild(row);
        });
    }
}

function sellInv(i) {
    state.cash += 15000;
    state.inv.splice(i, 1);
    openModal('inv');
    addLog("üí∞ Dino vendido!");
}

function fuse(t) {
    let d1_name = (t === "Indominus Rex") ? "Tyrannosaurus Rex" : "Indominus Rex";
    let d2_name = "Velociraptor";
    let cost = (t === "Indominus Rex") ? 500000 : 1000000;

    let idx1 = state.dinos.findIndex(d => d.name === d1_name && d.lvl >= 30);
    let idx2 = state.dinos.findIndex(d => d.name === d2_name && d.lvl >= 30);

    if(idx1 !== -1 && idx2 !== -1 && state.cash >= cost) {
        state.cash -= cost;
        // Remove os dinos usados do mapa
        let toRemove = [idx1, idx2].sort((a,b) => b - a);
        state.dinos.splice(toRemove[0], 1);
        state.dinos.splice(toRemove[1], 1);
        
        state.inv.push(generate('hibrido', t));
        addLog("üß¨ H√≠brido criado com sucesso!");
        closeModals();
        render();
        save();
    } else {
        alert("Precisa dos dois dinos Lvl 30 no MAPA e cr√©ditos!");
    }
}

function startPlacement(i) { state.placing = state.inv.splice(i, 1)[0]; state.placing.x = Math.abs(state.cam.x)+200; state.placing.y = Math.abs(state.cam.y)+200; document.getElementById('btn-confirm').style.display='block'; closeModals(); render(); }
function confirmPlacement() { state.dinos.push(state.placing); state.placing = null; document.getElementById('btn-confirm').style.display='none'; render(); save(); }
function openPanel(i) { state.selected = i; let d = state.dinos[i]; document.getElementById('panel').style.display = 'block'; document.getElementById('p-name').innerText = d.name; document.getElementById('p-up-cost').innerText = abb(d.lvl * 50000); }
function upgradeDino() { let d = state.dinos[state.selected]; let cost = d.lvl * 50000; if(state.food >= cost) { state.food -= cost; d.lvl++; openPanel(state.selected); render(); } }
function sellDino() { state.cash += 50000; state.dinos.splice(state.selected, 1); closePanel(); render(); save(); }
function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
function closePanel() { document.getElementById('panel').style.display='none'; }
function addLog(t) { const l = document.getElementById('log'); const d = document.createElement('div'); d.className = 'log-msg'; d.innerText = t; l.prepend(d); setTimeout(()=>d.remove(), 4000); }
function updateLabels() { state.dinos.forEach((d, i) => { const t = document.getElementById(`inc-${i}`); if(t) t.innerText = `+$${abb(d.lastInc)}/s`; }); }
function render() {
    const layer = document.getElementById('entities-layer'); layer.innerHTML = '';
    state.dinos.forEach((d, i) => {
        if(d.world !== state.world) return;
        const div = document.createElement('div'); div.className = 'entity'; div.style.left = d.x+'px'; div.style.top = d.y+'px';
        div.onclick = () => openPanel(i);
        div.innerHTML = `<div class="cage rar-${d.rar}"><div class="lvl-badge">LV. ${d.lvl}</div><div style="font-size:40px">${d.img}</div><div class="income-tag" id="inc-${i}">+$0/s</div></div>`;
        layer.appendChild(div);
    });
    if(state.placing) { document.getElementById('placement-indicator').style.display = 'block'; document.getElementById('placement-indicator').style.left = state.placing.x+'px'; document.getElementById('placement-indicator').style.top = state.placing.y+'px'; }
    else document.getElementById('placement-indicator').style.display = 'none';
}
function setupFood() { const b = document.getElementById('btn-food'); let t; b.onpointerdown = () => t = setInterval(() => { if(state.cash >= 2500){ state.cash -= 2500; state.food += 15000; } }, 70); b.onpointerup = () => clearInterval(t); }
function save() { localStorage.setItem('DINO_SAVE', JSON.stringify(state)); }
function load() { let r = localStorage.getItem('DINO_SAVE'); if(r) state = {...state, ...JSON.parse(r)}; }
function startExp(t, c) { if(state.cash >= c) { state.cash -= c; state.expEnd = Date.now() + (t*1000); } }
function finishExp() { state.expEnd = 0; state.cenoDNA++; addLog("üì¶ Expedi√ß√£o trouxe Ceno-DNA!"); save(); }
function initMove() { state.placing = state.dinos.splice(state.selected, 1)[0]; document.getElementById('btn-confirm').style.display='block'; closePanel(); render(); }

let isD = false, lx, ly;
window.onpointerdown = (e) => { isD = true; lx = e.pageX; ly = e.pageY; };
window.onpointermove = (e) => { if(!isD) return; let dx = e.pageX - lx; let dy = e.pageY - ly; if(state.placing) { state.placing.x += dx; state.placing.y += dy; render(); } else { state.cam.x += dx; state.cam.y += dy; document.getElementById('map').style.transform = `translate(${state.cam.x}px, ${state.cam.y}px)`; } lx = e.pageX; ly = e.pageY; };
window.onpointerup = () => isD = false;

load(); setInterval(tick, 100); setupFood(); render();
</script>
</body>
</html>
