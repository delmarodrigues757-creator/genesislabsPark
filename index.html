<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DINO EMPIRE: MEGA EDITION</title>
    <style>
        :root { 
            --comum: #7f8c8d; --incomum: #2ecc71; --raro: #00d4ff; 
            --epico: #a55eea; --lendario: #f1c40f; --hibrido: #ff00ff; --ceno: #00f2ff;
            --n: #00d4ff; --bg: #02050a;
        }
        * { box-sizing: border-box; font-family: 'Orbitron', sans-serif; user-select: none; outline:none; }
        body { margin: 0; background: var(--bg); color: #fff; height: 100vh; overflow: hidden; touch-action: none; }

        /* HUD */
        #hud { display: grid; grid-template-columns: repeat(4, 1fr); background: rgba(5, 10, 20, 0.95); padding: 15px; position: fixed; width: 100%; top: 0; z-index: 1000; border-bottom: 2px solid var(--n); }
        .v { font-size: 13px; font-weight: 900; color: #fff; }
        .l { font-size: 8px; color: var(--n); text-transform: uppercase; display: block; }

        /* BOT√ÉO MAPA */
        #btn-map-toggle { cursor:pointer; text-align:center; border-radius:8px; border:1px solid var(--n); transition: 0.3s; }
        .active-ceno { border-color: var(--ceno) !important; background: rgba(0, 242, 255, 0.2); box-shadow: 0 0 10px var(--ceno); }

        /* MAPA */
        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
        #map { position: absolute; width: 8000px; height: 8000px; transform-origin: 0 0; }
        .map-normal { background-color: #02050a; background-image: linear-gradient(rgba(0, 212, 255, 0.05) 1.5px, transparent 1.5px), linear-gradient(90deg, rgba(0, 212, 255, 0.05) 1.5px, transparent 1.5px); background-size: 80px 80px; }
        .map-ceno { background-color: #0d2533; background-image: radial-gradient(circle, #00f2ff22 1px, transparent 1px); background-size: 50px 50px; }
        
        /* ENTIDADES */
        .entity { position: absolute; transform: translate(-50%, -50%); z-index: 10; }
        .cage { width: 110px; height: 110px; border: 3px solid #fff; border-radius: 25px; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; position: relative; }
        .income-tag { position: absolute; bottom: -25px; background: #000; color: #2ecc71; padding: 2px 8px; border-radius: 5px; font-size: 10px; font-weight: 900; border: 1px solid #2ecc71; white-space: nowrap; }
        .lvl-badge { position: absolute; top: -12px; background: #fff; color: #000; padding: 2px 10px; border-radius: 10px; font-size: 9px; font-weight: 900; border: 2px solid var(--n); }

        /* MIRA NEON */
        .placement-guide { position: absolute; width: 150px; height: 150px; border: 3px dashed var(--n); border-radius: 50%; transform: translate(-50%, -50%); background: rgba(0, 212, 255, 0.1); pointer-events: none; z-index: 5; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { scale: 0.9; opacity: 0.3; } 50% { scale: 1.1; opacity: 0.7; } }

        /* MODAIS */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.96); padding: 20px; display: none; z-index: 5000; overflow-y: auto; }
        .m-card { background: #0d1526; border: 2px solid var(--n); border-radius: 30px; padding: 20px; max-width: 500px; margin: auto; }
        .btn { background: var(--n); color: #000; border: none; padding: 12px; border-radius: 12px; width: 100%; margin: 4px 0; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 11px; }

        nav { position: fixed; bottom: 0; width: 100%; height: 85px; background: rgba(5, 10, 20, 0.98); border-top: 2px solid var(--n); display: flex; z-index: 1000; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 8px; }
        .nav-item span { font-size: 22px; margin-bottom: 3px; }

        #panel { position: fixed; bottom: 95px; left: 5%; width: 90%; background: #0d1526; border: 2px solid var(--n); border-radius: 25px; padding: 15px; display: none; z-index: 2000; }
        #log { position: fixed; bottom: 95px; left: 10px; pointer-events: none; z-index: 4000; }
        .log-msg { background: rgba(0,0,0,0.9); color: var(--n); padding: 8px 15px; border-radius: 8px; margin-top: 5px; font-size: 10px; border-left: 4px solid var(--n); animation: fO 4s forwards; }

        /* RARIDADES */
        .rar-comum { border-color: var(--comum); }
        .rar-incomum { border-color: var(--incomum); }
        .rar-raro { border-color: var(--raro); box-shadow: 0 0 10px var(--raro); }
        .rar-epico { border-color: var(--epico); box-shadow: 0 0 15px var(--epico); }
        .rar-lendario { border-color: var(--lendario); box-shadow: 0 0 20px var(--lendario); }
        .rar-hibrido { border-color: var(--hibrido); box-shadow: 0 0 20px var(--hibrido); }

        /* ESTILO INVENTARIO */
        .inv-item { display: flex; gap: 5px; margin-bottom: 5px; }
        .btn-sell-inv { background: #e74c3c !important; color: white !important; width: 60px !important; }

        @keyframes fO { 0% { opacity: 1; } 100% { opacity: 0; transform: translateX(-30px); } }
    </style>
</head>
<body>

<div id="log"></div>

<div id="hud">
    <div><span class="l">CR√âDITOS</span><span id="v-cash" class="v">$0</span></div>
    <div><span class="l">CARNE</span><span id="v-food" class="v">0</span></div>
    <div><span class="l">CENO-DNA</span><span id="v-ceno" class="v">0</span></div>
    <div id="btn-map-toggle" onclick="switchWorld()">
        <span class="l">MAPA</span><span id="v-world" class="v">NORMAL</span>
    </div>
</div>

<div id="viewport">
    <div id="map" class="map-normal">
        <div id="placement-indicator" class="placement-guide" style="display:none"></div>
        <div id="entities-layer"></div>
    </div>
</div>

<button id="btn-confirm" class="btn" style="position:fixed; bottom:100px; left:50%; transform:translateX(-50%); width:200px; display:none; z-index:4000; background:var(--incomum); border: 2px solid #fff" onclick="confirmPlacement()">SOLTAR AQUI ‚úÖ</button>

<div id="modal-shop" class="modal"><div class="m-card"><h2>LOJA</h2><div style="display:grid; grid-template-columns:1fr 1fr; gap:8px"><button class="btn" onclick="buy('carn', 30000)">ü•© CARN√çVOROS<br>$30K</button><button class="btn" onclick="buy('herb', 20000)">üåø HERB√çVOROS<br>$20K</button><button class="btn" onclick="buy('fly', 45000)">ü¶Ö VOADORES<br>$45K</button><button class="btn" onclick="buy('wat', 70000)">ü¶à AQU√ÅTICOS<br>$70K</button></div><button class="btn" style="background:var(--ceno); margin-top:10px; border:2px solid #fff" onclick="buy('ceno', 0)">üß¨ USAR CENO-DNA (1)</button><button class="btn" style="background:#333; color:#fff" onclick="closeModals()">FECHAR</button></div></div>

<div id="modal-lab" class="modal"><div class="m-card"><h2>LABORAT√ìRIO</h2><div style="background:rgba(0,0,0,0.5); padding:10px; border-radius:15px; border-left:4px solid var(--hibrido); margin-bottom:10px"><b>INDOMINUS REX ($500K)</b><br><small>T-Rex Lvl 30 + Raptor Lvl 30</small></div><button class="btn" onclick="fuse('Indominus Rex')">üß¨ FUNDIR INDOMINUS</button><div style="background:rgba(0,0,0,0.5); padding:10px; border-radius:15px; border-left:4px solid var(--hibrido); margin:10px 0"><b>INDORAPTOR ($1M)</b><br><small>Indominus Lvl 30 + Raptor Lvl 30</small></div><button class="btn" onclick="fuse('Indoraptor')">üß¨ FUNDIR INDORAPTOR</button><button class="btn" style="background:#333" onclick="closeModals()">FECHAR</button></div></div>

<div id="modal-exp" class="modal"><div class="m-card"><h2>EXPEDI√á√ÉO GLOBAL</h2><div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; border: 1px solid var(--n)"><b>MISS√ÉO DE BUSCA</b><br><p>Custo: $75K | Tempo: 40s</p><button id="exp-btn" class="btn" onclick="startExp(40, 75000)">INICIAR</button></div><p id="exp-timer" style="text-align:center; color:var(--n); font-weight:900"></p><button class="btn" style="background:#333" onclick="closeModals()">FECHAR</button></div></div>

<div id="modal-index" class="modal"><div class="m-card"><h2>DINOP√âDIA (100)</h2><div id="idx-list" style="display:grid; grid-template-columns:repeat(2,1fr); gap:6px"></div><button class="btn" onclick="closeModals()">FECHAR</button></div></div>
<div id="modal-inv" class="modal"><div class="m-card"><h2>INVENT√ÅRIO</h2><div id="inv-grid"></div><button class="btn" onclick="closeModals()">FECHAR</button></div></div>

<div id="panel">
    <h2 id="p-name" style="margin:0"></h2>
    <div id="p-stats" style="margin:10px 0; font-size:12px; color:#aaa"></div>
    <button class="btn" onclick="upgradeDino()">ü•© ALIMENTAR ($<span id="p-up-cost"></span>)</button>
    <button class="btn" style="background:#f1c40f" onclick="initMove()">üöö MOVER</button>
    <button class="btn" style="background:#e74c3c; color:#fff" onclick="sellDino()">VENDER</button>
    <button class="btn" style="background:#333; color:#fff" onclick="closePanel()">VOLTAR</button>
</div>

<nav>
    <div class="nav-item" onclick="openModal('shop')"><span>üõí</span>LOJA</div>
    <div class="nav-item" onclick="openModal('lab')"><span>üß™</span>LAB</div>
    <div class="nav-item" onclick="openModal('exp')"><span>üó∫Ô∏è</span>EXPED</div>
    <div class="nav-item" onclick="openModal('index')"><span>üìñ</span>INDEX</div>
    <div class="nav-item" onclick="openModal('inv')"><span>üß¨</span>INV</div>
    <div class="nav-item" id="btn-food"><span>ü•©</span>CARNE</div>
</nav>

<script>
function abb(n) {
    if(n >= 1e9) return (n/1e9).toFixed(1).replace(/\.0$/,'')+'B';
    if(n >= 1e6) return (n/1e6).toFixed(1).replace(/\.0$/,'')+'M';
    if(n >= 1e3) return (n/1e3).toFixed(1).replace(/\.0$/,'')+'K';
    return Math.floor(n).toString();
}

const DATA = {
    carn: [{n:"Tyrannosaurus Rex", e:"Rex"}, {n:"Velociraptor", e:"Rap"}, {n:"Spinosaurus", e:"Spi"}, {n:"Giganotosaurus", e:"Gig"}, {n:"Allosaurus", e:"Allo"}, {n:"Baryonyx", e:"Bar"}, {n:"Carnotaurus", e:"Car"}, {n:"Dilophosaurus", e:"Dil"}, {n:"Ceratosaurus", e:"Cer"}, {n:"Majungasaurus", e:"Maj"}, {n:"Albertosaurus", e:"Alb"}, {n:"Utahraptor", e:"Uta"}, {n:"Acrocanthosaurus", e:"Acro"}, {n:"Compsognathus", e:"Com"}, {n:"Metriacanthosaurus", e:"Met"}, {n:"Herrerasaurus", e:"Her"}, {n:"Troodon", e:"Tro"}, {n:"Yutyrannus", e:"Yut"}, {n:"Concavenator", e:"Con"}, {n:"Indosuchus", e:"Indo"}],
    herb: [{n:"Triceratops", e:"Tri"}, {n:"Brachiosaurus", e:"Bra"}, {n:"Stegosaurus", e:"Ste"}, {n:"Ankylosaurus", e:"Ank"}, {n:"Parasaurolophus", e:"Par"}, {n:"Diplodocus", e:"Dip"}, {n:"Apatosaurus", e:"Apa"}, {n:"Iguanodon", e:"Igu"}, {n:"Pachycephalosaurus", e:"Pac"}, {n:"Styracosaurus", e:"Sty"}, {n:"Gallimimus", e:"Gal"}, {n:"Therizinosaurus", e:"The"}, {n:"Maiasaura", e:"Maia"}, {n:"Corythosaurus", e:"Cor"}, {n:"Edmontosaurus", e:"Edm"}, {n:"Argentinosaurus", e:"Arg"}, {n:"Ouranosaurus", e:"Our"}, {n:"Kentrosaurus", e:"Ken"}, {n:"Pachyrhinosaurus", e:"Pachy"}, {n:"Microceratus", e:"Mic"}],
    fly: [{n:"Pteranodon", e:"Pte"}, {n:"Quetzalcoatlus", e:"Que"}, {n:"Dimorphodon", e:"Dim"}, {n:"Tapejara", e:"Tap"}, {n:"Cearadactylus", e:"Cea"}, {n:"Archaeopteryx", e:"Arc"}, {n:"Rhamphorhynchus", e:"Rha"}, {n:"Tupandactylus", e:"Tup"}, {n:"Pterodactylus", e:"Pte"}, {n:"Alanqa", e:"Ala"}],
    wat: [{n:"Mosasaurus", e:"Mos"}, {n:"Plesiosaurus", e:"Ple"}, {n:"Elasmosaurus", e:"Ela"}, {n:"Tylosaurus", e:"Tyl"}, {n:"Kronosaurus", e:"Kro"}, {n:"Dunkleosteus", e:"Dun"}, {n:"Basilosaurus", e:"Bas"}, {n:"Ichthyosaurus", e:"Ich"}, {n:"Megalodon", e:"Meg"}, {n:"Liopleurodon", e:"Lio"}],
    ceno: [{n:"Tigre Dente de Sabre", e:"üêÖ"}, {n:"Mammuthus", e:"ü¶£"}, {n:"Gigantopitecos", e:"ü¶ç"}, {n:"Megatherium", e:"ü¶•"}, {n:"Smilodon Populator", e:"üê±"}, {n:"Doedicurus", e:"‚öΩ"}, {n:"Elasmotherium", e:"ü¶è"}, {n:"Procoptodon", e:"ü¶ò"}, {n:"Andrewsarchus", e:"üê∫"}, {n:"Entelodon", e:"üêó"}, {n:"Megaloceros", e:"ü¶å"}, {n:"Phorusrhacos", e:"üê¶"}, {n:"Uintatherium", e:"üêò"}, {n:"Arctodus", e:"üêª"}, {n:"Thylacosmilus", e:"üêÜ"}, {n:"Basilosaurus Ceno", e:"üê≥"}, {n:"Hyaenodon", e:"üêï"}, {n:"Deinotherium", e:"üêò"}, {n:"Sivatherium", e:"ü¶í"}, {n:"Diprotodon", e:"üê®"}, {n:"Macrauchenia", e:"üêò"}, {n:"Kelenken", e:"ü¶Ö"}, {n:"Titanoboa", e:"üêç"}, {n:"Gastornis", e:"ü¶Ü"}, {n:"Chalicotherium", e:"ü¶ç"}],
    hibrido: [{n:"Indominus Rex", e:"üß¨"}, {n:"Indoraptor", e:"üñ§"}, {n:"Stegoceratops", e:"üõ°Ô∏è"}, {n:"Spinoraptor", e:"üêä"}, {n:"Ankylodocus", e:"üî®"}, {n:"Koolasaurus", e:"üê∏"}, {n:"Ostafrikasaurus", e:"üëπ"}, {n:"Priotrodon", e:"üêâ"}, {n:"Suprannotitan", e:"üåã"}, {n:"Erliphosaurus", e:"ü¶¢"}, {n:"Giganocephalus", e:"üê¢"}, {n:"Pachyceratops", e:"üëä"}, {n:"Metrialong", e:"üêç"}, {n:"Unayrhynchus", e:"üê¶"}, {n:"Rajastega", e:"üëë"}]
};

// Pequeno ajuste nos emojis visuais para facilitar a leitura
Object.keys(DATA).forEach(k => DATA[k].forEach(d => { if(d.e.length < 4) d.e = "ü¶ñ"; }));

let state = { cash: 100000, food: 100000, cenoDNA: 0, dinos: [], inv: [], discovered: [], expEnd: 0, world: 'normal', cam: {x:-3800, y:-3800} };

function tick() {
    let inc = 0;
    state.dinos.forEach(d => {
        let b = (d.cat === 'ceno' || d.rar === 'hibrido') ? 1500 : 250;
        let m = {comum:1, incomum:3, raro:10, epico:30, lendario:100, hibrido:400}[d.rar] || 1;
        let p = (d.lvl * b * m) / 10; inc += p; d.lastInc = p * 10;
    });
    state.cash += inc;

    if(state.expEnd > Date.now()) {
        document.getElementById('exp-timer').innerText = `Equipe em miss√£o: ${Math.ceil((state.expEnd - Date.now())/1000)}s`;
        document.getElementById('exp-btn').disabled = true;
    } else {
        if(state.expEnd !== 0) finishExp();
        document.getElementById('exp-timer').innerText = "";
        document.getElementById('exp-btn').disabled = false;
    }

    document.getElementById('v-cash').innerText = "$" + abb(state.cash);
    document.getElementById('v-food').innerText = abb(state.food);
    document.getElementById('v-ceno').innerText = state.cenoDNA;
    updateLabels();
}

function switchWorld() {
    const btn = document.getElementById('btn-map-toggle');
    const label = document.getElementById('v-world');
    if (state.world === 'normal') {
        state.world = 'ceno'; label.innerText = "CENOZOICO"; btn.classList.add('active-ceno');
        document.getElementById('map').className = 'map-ceno';
    } else {
        state.world = 'normal'; label.innerText = "NORMAL"; btn.classList.remove('active-ceno');
        document.getElementById('map').className = 'map-normal';
    }
    render();
}

function buy(cat, p) {
    if(cat === 'ceno') {
        if(state.cenoDNA >= 1) { state.cenoDNA--; state.inv.push(generate('ceno')); addLog("‚ùÑÔ∏è DNA Usado!"); openModal('inv'); }
        else alert("Voc√™ precisa de Ceno-DNA!"); return;
    }
    if(state.cash >= p) { state.cash -= p; state.inv.push(generate(cat)); openModal('inv'); }
}

function startExp(t, c) { if(state.cash >= c) { state.cash -= c; state.expEnd = Date.now() + (t*1000); addLog("‚úàÔ∏è Avi√£o decolou!"); } }

function finishExp() {
    state.expEnd = 0; let r = Math.random();
    if(r < 0.05) { state.cenoDNA++; addLog("‚ú® RARO: Ceno-DNA Encontrado!"); }
    else if(r < 0.25) { let a = 50000 + Math.random()*100000; state.food += a; addLog(`ü•© +${abb(a)} Carne!`); }
    else if(r < 0.55) { let a = 200000 + Math.random()*300000; state.cash += a; addLog(`üí∞ +$${abb(a)} Cr√©ditos!`); }
    else { state.inv.push(generate('carn')); addLog("ü¶¥ F√≥ssil recuperado."); }
    save();
}

function generate(cat, forced = null) {
    const pool = DATA[cat];
    let obj = forced ? pool.find(x => x.n === forced) : pool[Math.floor(Math.random() * pool.length)];
    let rar = 'comum'; let r = Math.random();
    if(cat === 'ceno') { if(r > 0.99) rar = 'lendario'; else if(r > 0.95) rar = 'epico'; else if(r > 0.85) rar = 'raro'; else if(r > 0.6) rar = 'incomum'; }
    else if(!forced) { if(r > 0.98) rar = 'lendario'; else if(r > 0.9) rar = 'epico'; else if(r > 0.7) rar = 'raro'; else if(r > 0.4) rar = 'incomum'; }
    else rar = 'hibrido';
    if(!state.discovered.includes(obj.n)) state.discovered.push(obj.n);
    return { name: obj.n, img: obj.e, cat, rar, lvl: 1, x:0, y:0, world: (cat==='ceno'?'ceno':'normal'), lastInc: 0 };
}

function openPanel(i) {
    state.selected = i; let d = state.dinos[i]; document.getElementById('panel').style.display = 'block';
    document.getElementById('p-name').innerText = d.name; document.getElementById('p-up-cost').innerText = abb(d.lvl * 50000);
    document.getElementById('p-stats').innerText = `${d.rar.toUpperCase()} | Lucro: $${abb(d.lastInc)}/s`;
}

function upgradeDino() {
    let d = state.dinos[state.selected]; let cost = d.lvl * 50000;
    if(state.food >= cost) { state.food -= cost; d.lvl++; openPanel(state.selected); render(); addLog("‚≠ê Level UP!"); }
}

// CORRE√á√ÉO DO BUG: Remover os dinos usados na fus√£o
function fuse(t) {
    let reqs = [];
    if(t==='Indominus Rex') reqs = ["Velociraptor", "Tyrannosaurus Rex"];
    if(t==='Indoraptor') reqs = ["Indominus Rex", "Velociraptor"];

    let cost = t === 'Indominus Rex' ? 5e5 : 1e6;
    
    // Verifica se tem os dois dinos no n√≠vel 30
    let d1 = state.dinos.findIndex(d => d.name === reqs[0] && d.lvl >= 30);
    let d2 = state.dinos.findIndex(d => d.name === reqs[1] && d.lvl >= 30);

    if(d1 !== -1 && d2 !== -1 && state.cash >= cost) {
        state.cash -= cost;
        // Remove os dinos usados (ordem decrescente para n√£o errar o index)
        let indices = [d1, d2].sort((a,b) => b-a);
        state.dinos.splice(indices[0], 1);
        state.dinos.splice(indices[1], 1);
        
        state.inv.push(generate('hibrido', t)); 
        addLog("üß¨ SUCESSO NO EXPERIMENTO!");
        closeModals();
        render();
        save();
    } else {
        alert("Requisitos: Ambos dinos n√≠vel 30 no MAPA + Cr√©ditos.");
    }
}

function addLog(t) { const l = document.getElementById('log'); const d = document.createElement('div'); d.className = 'log-msg'; d.innerText = t; l.prepend(d); setTimeout(()=>d.remove(), 4000); }
function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display='none'); }
function closePanel() { document.getElementById('panel').style.display='none'; }
function updateLabels() { state.dinos.forEach((d, i) => { const t = document.getElementById(`inc-${i}`); if(t) t.innerText = `+$${abb(d.lastInc)}/s`; }); }

function render() {
    const layer = document.getElementById('entities-layer'); layer.innerHTML = '';
    state.dinos.forEach((d, i) => {
        if(d.world !== state.world) return;
        const div = document.createElement('div'); div.className = 'entity'; div.style.left = d.x+'px'; div.style.top = d.y+'px';
        div.onclick = () => openPanel(i);
        div.innerHTML = `<div class="cage rar-${d.rar}"><div class="lvl-badge">LV. ${d.lvl}</div><div style="font-size:40px">${d.img}</div><div class="income-tag" id="inc-${i}">+$0/s</div></div>`;
        layer.appendChild(div);
    });
    const ind = document.getElementById('placement-indicator');
    if(state.placing) { ind.style.display = 'block'; ind.style.left = state.placing.x+'px'; ind.style.top = state.placing.y+'px'; }
    else ind.style.display = 'none';
}

function openModal(id) {
    closeModals(); document.getElementById('modal-'+id).style.display = 'block';
    if(id === 'inv') { 
        const g = document.getElementById('inv-grid'); 
        g.innerHTML = ''; 
        state.inv.forEach((d, i) => {
            const item = document.createElement('div');
            item.className = 'inv-item';
            item.innerHTML = `
                <button class="btn" style="flex:1; border-bottom:3px solid var(--${d.rar})" onclick="startPlacement(${i})">${d.img} ${d.name}</button>
                <button class="btn btn-sell-inv" onclick="sellFromInv(${i})">VENDER</button>
            `;
            g.appendChild(item);
        }); 
    }
    if(id === 'index') { const l = document.getElementById('idx-list'); l.innerHTML = ''; Object.values(DATA).flat().forEach(obj => { const f = state.discovered.includes(obj.n); l.innerHTML += `<div style="background:rgba(255,255,255,0.05); padding:5px; border-radius:8px; font-size:9px; ${f?'':'opacity:0.2'}">${f?obj.e:'?'} ${f?obj.n:'???'}</div>`; }); }
}

// Vender direto do invent√°rio
function sellFromInv(i) {
    state.cash += 15000;
    state.inv.splice(i, 1);
    openModal('inv');
    addLog("üí∞ Vendido por $15K");
    save();
}

function startPlacement(i) { state.placing = state.inv.splice(i, 1)[0]; state.placing.x = Math.abs(state.cam.x)+window.innerWidth/2; state.placing.y = Math.abs(state.cam.y)+window.innerHeight/2; document.getElementById('btn-confirm').style.display='block'; closeModals(); render(); }
function confirmPlacement() { state.dinos.push(state.placing); state.placing = null; document.getElementById('btn-confirm').style.display='none'; render(); save(); }
function initMove() { state.placing = state.dinos.splice(state.selected, 1)[0]; document.getElementById('btn-confirm').style.display='block'; closePanel(); render(); }
function sellDino() { state.cash += 50000; state.dinos.splice(state.selected, 1); closePanel(); render(); save(); }
function setupFood() { const b = document.getElementById('btn-food'); let t; b.onpointerdown = () => t = setInterval(() => { if(state.cash >= 2500){ state.cash -= 2500; state.food += 15000; } }, 70); b.onpointerup = () => clearInterval(t); }

function save() { localStorage.setItem('DINO_FULL_SAVE', JSON.stringify(state)); }
function load() { let r = localStorage.getItem('DINO_FULL_SAVE'); if(r) state = {...state, ...JSON.parse(r)}; }

let isD = false, lx, ly;
window.onpointerdown = (e) => { isD = true; lx = e.pageX; ly = e.pageY; };
window.onpointermove = (e) => { if(!isD) return; let dx = e.pageX - lx; let dy = e.pageY - ly; if(state.placing) { state.placing.x += dx; state.placing.y += dy; render(); } else { state.cam.x += dx; state.cam.y += dy; document.getElementById('map').style.transform = `translate(${state.cam.x}px, ${state.cam.y}px)`; } lx = e.pageX; ly = e.pageY; };
window.onpointerup = () => isD = false;

load(); setInterval(tick, 100); setupFood(); render();
</script>
</body>
</html>
